<!doctype html>
<html>
  <head>
    <title>Microdot WebSocket Demo</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./mvp.css">
    <link rel="stylesheet" href="./style_v4ws.css">
  </head>
  <body>
    <main class="container">
      <div>
        <h1>LED WebSocket Demo</h1>
        <figure>
          <img src="computer.svg" height="300" width="300" alt="Pico W Icon" />
        </figure>
      </div>
      <div class="leds">
        <div class="led_1">
        <input type="checkbox" id="stateCheckbox_1" class="visually-hidden"/>
        <label class="state-image_1" for="stateCheckbox_1">Yellow</label>
        <img src="off.svg" id="stateImage_1" height="100" width="100" alt="LED 1 off" />
      </div>
      <div class="led_2">
        <input type="checkbox" id="stateCheckbox_2" class="visually-hidden"/>
        <label class="state-image_2" for="stateCheckbox_2">Green</label>
        <img src="off.svg" id="stateImage_2" height="100" width="100" alt="LED 1 off" />
      </div>
      </div>
    </main>
    <script>
      // 1. Connect to a WebSocket server at the 'ws' endpoint
      const socket = new WebSocket('ws://' + location.host + '/ws');

      // 2. Setup checkbox with the name of 'stateCheckbox'
      // image will reflect the state of the checkbox
      // on load, set state to off
      const checkbox_1 = document.getElementById('stateCheckbox_1');
      const stateImage_1 = document.getElementById('stateImage_1');
      setStateImage_1(); 

      const checkbox_2 = document.getElementById('stateCheckbox_2');
      const stateImage_2 = document.getElementById('stateImage_2');
      setStateImage_2(); 

      // Listen for checkbox changes and change state image
      checkbox_1.addEventListener('change', setStateImage_1);

      checkbox_2.addEventListener('change', setStateImage_2);


      // 3. When checkbox state changes, also send state to socket
      // 'true' for checked (on) and 'false' for unchecked (off)
        checkbox_1.addEventListener('change', () => {
          socket.send("1" + checkbox_1.checked); 
        });

        checkbox_2.addEventListener('change', () => {
          socket.send(["2" + checkbox_2.checked]); 
        });

      // function changes image based on state of checkbox
      function setStateImage_1() {
        if(checkbox_1.checked) {
          stateImage_1.src = "on_yellow.svg"; 
        } else {
          stateImage_1.src = "off.svg";
        }

      }

    function setStateImage_2() {
      if(checkbox_2.checked) {
        stateImage_2.src = "on_green.svg"; 
      } else {
        stateImage_2.src = "off.svg";
      }

    }
    </script>
  </body>
</html>


