<!doctype html>
<html>
  <head>
    <title>Microdot WebSocket Demo</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./mvp.css">
    <link rel="stylesheet" href="./style_v5tt.css">
  </head>
  <body>
    <main class="container">
      <div>
        <h1>LED WebSocket Demo v5 Time Test</h1>
        <figure>
          <img src="computer.svg" height="300" width="300" alt="Pico W Icon" />
        </figure>
      </div>
      <div class="leds">
      
        <input type="checkbox" id="stateCheckbox" class="visually-hidden"/>
        <label class="state-image" for="stateCheckbox">Click</label>

        <input type="number" id="elapsed" class="visually-hidden"/>

        <img src="off.svg" id="stateImage" height="100" width="100" alt="LED off" />
      
      </div>
    </main>
    <script>
      // Connect to a WebSocket server at the 'ws' endpoint
      const socket = new WebSocket('ws://' + location.host + '/ws');

      // Setup checkbox with the name of 'stateCheckbox'
      // image will reflect the state of the checkbox
      // on load, set state to off
      const checkbox = document.getElementById('stateCheckbox');
      const stateImage = document.getElementById('stateImage');
      setStateImage(); 

      // Listen for checkbox changes and change state image
      checkbox.addEventListener('change', setStateImage);


      // When checkbox state changes, also send state to socket
      // 'true' for checked (on) and 'false' for unchecked (off)
      checkbox.addEventListener('change', () => {
        socket.send(checkbox.checked);
      });

      // When the websocket receives an elapsed time from light_leds_tt
      // it stores it in the hidden number field, elapsed  
      socket.addEventListener('message', event => {
        const elapsed = event.data * 0.001; 
        document.getElementById('elapsed').value = elapsed;
      });

      // function changes image based on state of checkbox
      function setStateImage() {
        if(checkbox.checked) {
          stateImage.src = "on.svg"; 
        } else {
          stateImage.src = "off.svg";
        }

      }

    </script>
  </body>
</html>


